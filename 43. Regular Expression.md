# 43. Regular Expression

- 정규표현식(regular expression)은 일정한 패턴을 가진 문자열을 표현하는 방법
- 정규 표현식은 `re` (**r**egular **e**xpression) 모듈을 사용하여 표현한다.



## 43.1 문자열 판단하기

- 일치 객체는 항상 불리언 값 `True`를 가진다.

| 함수                     | 반환       | 설명                                                         |
| ------------------------ | ---------- | ------------------------------------------------------------ |
| `re.match(패턴, 문자열)` | `re.Match` | `문자열`의 **시작 부분**이 정규식 `패턴`과 일치하면, 해당하는 일치 객체를 반환한다. 그렇지 않다면 `None`을 반환한다. |



```python
import re

ismatched = re.match('Hello', 'Hello, world!')
if ismatched:
    print('ismatched')	# ismatched
```



### 43.1.1 문자열이 맨 앞에 오는지 맨 뒤에 오는지 판단하기

| 패턴      | 설명                           |
| --------- | ------------------------------ |
| `^문자열` | 문자열의 시작 부분을 판단한다. |
| `문자열$` | 문자열의 끝 부분을 판단한다.   |

| 함수                      | 반환       | 설명                                                         |
| ------------------------- | ---------- | ------------------------------------------------------------ |
| `re.search(패턴, 문자열)` | `re.Match` | `문자열`의 일부분이 정규식 `패턴`과 일치하면, 해당하는 일치 객체를 반환한다. 그렇지 않다면 `None`을 반환한다. |

```python
import re

re.serach('^Hello', 'Hello, world!')
re.serach('world$', 'Hello, world!')
```



### 43.1.2 지정된 문자열이 하나라도 포함되는지 판단하기

| 패턴                  | 설명                                             |
| --------------------- | ------------------------------------------------ |
| `문자열1|문자열2|...` | 문자열에 `문자열` 중 하나가 포함되는지 판단한다. |

```python
re.match('hello|world', 'hello')
re.search('el|o', 'hello')
```



## 43.2 범위 판단하기

| 패턴                 | 설명                                                         |
| -------------------- | ------------------------------------------------------------ |
| `[]`                 | 범위를 묶어 표현한다.                                        |
| `문자*`<br />`범위*` | `문자` 혹은 `범위`에 속하는 문자가 0개 이상 있는지 판단한다. |
| `문자+`<br />`범위*` | `문자` 혹은 `범위`에 속하는 문자가 1개 이상 있는지 판단한다. |
| `[0-9]*`             | digit이 0개 이상 있는지 확인한다.                            |
| `[0-9]+`             | digit이 1개 이상 있는지 확인한다.                            |

```python
re.match('[0-9]*', '1234')
re.match('[0-9]+', '1234')
```



### 43.2.1 문자가 한 개만 있는지 판단하기

| 패턴                 | 설명                                                         |
| -------------------- | ------------------------------------------------------------ |
| `문자?`<br />`범위?` | `문자` 혹은 `범위`에 속하는 문자가 0개 또는 1개 있는지 판단한다. |
| `.`                  | `.`의 위치에 있는 문자가 1개만 있는지 판단한다.              |

```python
re.match('abc?d', 'abcd')
re.match('ab.d', 'abxd')
```



### 43.2.2 문자 개수 판단하기

| 패턴                           | 설명                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| `{개수}`                       | 개수를 표현한다.                                             |
| `{시작, 끝}`                   | 개수가 `시작`~`끝`개인지 판단한다.                           |
| `문자{개수}`<br />`범위{개수}` | `문자` 혹은 `범위`에 속하는 문자가 `개수`만큼 있는지 판단한다. |
| `(문자열){개수}`               | `문자열`이 `개수`만큼 있는지 판단한다.                       |

```python
re.match('h{3}', 'hello')	# None

re.match('[0-9]{3}-[0-9]{4}-[0-9]{4}', '010-1000-1000')
re.match('[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}', '02-100-1000')
```



### 43.2.3  숫자와 영문 문자를 조합하여 판단하기

| 패턴      | 설명                           |
| --------- | ------------------------------ |
| `[a-z]`   | `a`부터 `z`가 있는지 판단한다. |
| `[A-Z]`   | `A`부터 `Z`가 있는지 판단한다. |
| `[가-힣]` | 한글 조합                      |

```python
# a부터 z까지, A부터 Z까지, 0부터 9까지 1개 이상 있는지 확인
re.match('[a-zA-Z0-9]+', 'hello1234')
```



### 43.2.4 특정 문자 범위에 포함되지 않는지 판단하기

| 패턴       | 설명                                                         |
| ---------- | ------------------------------------------------------------ |
| `[^범위]*` | `범위` 안에 속하는 문자를 제외한 문자들이 0개 이상 있는지 판단한다. |
| `[^범위]+` | `범위` 안에 속하는 문자를 제외한 문자들이 1개 이상 있는지 판단한다. |
| `^[범위]*` | 문자열의 시작부분에 `범위` 안에 속하는 문자가 0개 이상 있는지 판단한다. |
| `^[범위]+` | 문자열의 시작부분에 `범위` 안에 속하는 문자가 1개 이상 있는지 판단한다. |
| `[범위]*$` | 문자열의 끝부분에 `범위` 안에 속하는 문자가 0개 이상 있는지 판단한다. |
| `[범위]+$` | 문자열의 끝부분에 `범위` 안에 속하는 문자가 1개 이상 있는지 판단한다. |

```python
re.match('[^A-Z]*', 'Hello') # H를 제외한 문자들이 0개 이상 존재함
re.match('^[A-Z]+', 'Hello') # 영문 대문자로 시작함.
```



### 43.2.5 특수 문자 판단하기

| 패턴        | 설명                                                         |
| ----------- | ------------------------------------------------------------ |
| `\특수문자` | `특수문자`가 들어있는지 판단한다.<br />`[]` 안에 있는 경우 붙이지 않아도 되지만, 에러가 발생하는 경우에는 붙인다. |

```python
re.serach('\+', 'a+b')
re.search('[$()a-z]+', '(document)')
```

| 패턴 | 의미            | 설명                                              |
| ---- | --------------- | ------------------------------------------------- |
| `\d` | `[0-9]`         | 모든 숫자.                                        |
| `\D` | `[^0-9]`        | 모든 숫자를 제외한 문자.                          |
| `\w` | `[a-zA-Z0-9_]`  | 영문 대소문자, 숫자, 밑줄 문자.                   |
| `\W` | `[^a-zA-Z0-9_]` | 영문 대소문자, 숫자, 밑줄 문자를 제외한 모든 문자 |

```python
re.match('\d+', '1234')
```



### 43.2.6 공백 처리하기

| 패턴 | 의미              | 설명                                                         |
| ---- | ----------------- | ------------------------------------------------------------ |
| `\s` | ` [ \t\n\r\f\v]`  | 공백(스페이스), `\t`(탭), `\n`(새 줄, 라인 피드), `\r`(캐리지 리턴), `\f`(폼피드), `\v`(수직 탭) |
| `\S` | ` [^ \t\n\r\f\v]` | 공백을 제외하고  `\t`(탭), `\n`(새 줄, 라인 피드), `\r`(캐리지 리턴), `\f`(폼피드), `\v`(수직 탭) |



### 43.2.7 같은 정규표현식 패턴을 자주 사용하는 경우

| 함수                  | 반환         | 설명                             |
| --------------------- | ------------ | -------------------------------- |
| ` re.compile('패턴')` | `re.Pattern` | 정규표현식 패턴을 객체로 만든다. |

```python
객체 = re.compile('패턴')
객체.match('문자열')
객체.research('문자열')
```

```python
p = re.compile('[0-9]+')
p.match('1234')
p.search('hello')
```



## 43.3 그룹 사용하기

| 패턴                        | 설명                                          |
| --------------------------- | --------------------------------------------- |
| `(정규표현식) (정규표현식)` | `정규표현식`을 그룹으로 묶는다.               |
| ` (?P<이름>정규표현식)`     | `정규표현식`을 그룹으로 묶고 `이름`을 짓는다. |

| 함수                         | 반환          | 설명                                                         |
| ---------------------------- | ------------- | ------------------------------------------------------------ |
| `매치객체.group(그룹인덱스)` | `str | tuple` | 단일 인자에 대하여 단일 문자열을, 여러 개의 인자에 대하여는 인자당 하나의 항목을 가진 튜플을 반환한다. |
| `매치객체.group(그룹이름)`   | `str`         | `그룹이름`으로 매칭된 문자열 반환한다.                       |
| `매치객체.groups()`          | `tuple`       | 각 그룹에 매칭된 문자열을 `tuple`로 반환한다.                |

```python
m = re.match('([0-9]+) ([0-9]+)', '10 295')
m.group() 	# '10 295'	매칭된 문자열을 한꺼번에 반환
m.group(0)	# '10 295'	매칭된 문자열을 한꺼번에 반환
m.group(1) 	# '10'		그룹 1에 매칭된 문자열을 반환
m.group(2) 	# '295'		그룹 2에 매칭된 문자열을 반환
m.group(1, 2)	# ('10', '295')	# 그룹1, 그룹2에 매칭된 문자열을 튜플로 반환
m.groups()	# ('10', '295')	각 그룹에 매칭된 문자열을 튜플로 반환
```

```python
m = re.match('(?P<func>[a-zA-Z_][a-zA-Z0-9_]+)\((?P<arg>\w+)\)',
            'print(1234)')
m.group('func')	# print
b.group('arg')	# 1234
```



### 43.3.1 패턴에 매칭되는 모든 문자열 가져오기

| 함수                       | 반환   | 설명                                        |
| -------------------------- | ------ | ------------------------------------------- |
| `re.findall(패턴, 문자열)` | `list` | `패턴`에 매칭된 문자열을 리스트로 반환한다. |

```python
re.findall('[0-9]+', '1 2 Hello 3 World 5 6')
# ['1', '2', '3', '5', '6']
```



### 43.3.2 *와 +을 그룹에 활용하기

```python
re.match('[a-z]+(.[a-z]+)*$', 'hello.world')
```



## 43.4 문자열 바꾸기

| 함수                                         | 반환  | 설명                                                         |
| -------------------------------------------- | ----- | ------------------------------------------------------------ |
| `re.sub(패턴, 바꿀문자열, 문자열, 바꿀횟수)` | `str` | `문자열`에서 `패턴`에 일치하는 문자열을 찾아 `바꿀문자열`로 `바꿀횟수`만큼 바꾼 문자열을 반환한다. `바꿀횟수`를 생략하면 찾은 모든 문자열을 바꾼다. |
| `re.sub(패턴, 함수, 문자열, 바꿀횟수)`       | `str` | `문자열`에서 `패턴`에 일치하는 문자열을 찾아 `바꿀문자열`로 `바꿀횟수`만큼 바꾼 문자열을 반환한다. `바꿀횟수`를 생략하면 찾은 모든 문자열을 바꾼다. |

```python
re.sub('blue|yellow', 'color', 'blue hello yellow world')
# 'color hello color world'
```

```python
re.sub('[0-9]+', lambda m: str(int(m.group()) * 10), '1 2 Fizz 4 Buzz Fizz 7 8')
# '10 20 Fizz 40 Buzz Fizz 70 80'
```



### 43.4.1 찾은 문자열을 결과에 다시 적용하기

- 정규표현식을 그룹으로 묶고, `\\그룹인덱스 `혹은 `\\g<그룹이름>`, `\\g<그룹인덱스>`로 매칭된 문자열을 가져와 사용할 수 있다.

```python
re.sub('([a-z]+) ([0-9]+)', '\\2! \\1! \\2! \\1!', 'hello 1234')
# '1234! hello! 1234! hello!'

re.sub('({\s*)"(?P<key>\w+)":\s*"(?P<value>\w+)"(\s*})', '<\\g<key>>\\g<value></\\g<key>>', '{ "name": "james" }')
# '<name>james</name>'
```



### 43.4.2 raw 문자열을 사용하기

- 문자열 앞에 `r`을 붙이면 원시(raw) 문자열이 된다.
- 즉, `'\\그룹인덱스'`는 `r'\그룹인덱스'`처럼 사용할 수 있다.

```python
re.sub('({\s*)"(\w+)":\s*"(\w+)"(\s*})', r'<\2>\3</\2>', '{ "name": "james" }')
# '<name>james</name>'
```

